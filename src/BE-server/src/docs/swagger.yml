# ===========================================
# JOB SEARCH API - OPENAPI SPECIFICATION
# ===========================================

openapi: 3.0.3
info:
  title: Job Search API
  version: 1.0.0
  description: |
    Complete API documentation for Job Search application.

# ===========================================
# TAGS
# ===========================================

tags:
  - name: Server
    description: Server status endpoints
  - name: Jobs
    description: Job listing and details endpoints

# ===========================================
# COMPONENTS
# ===========================================

components:
  # ---------------------
  # Schemas
  # ---------------------
  schemas:
    # Standard Success Response
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        status:
          type: integer
          example: 200
        message:
          type: string
          example: "Operation successful"
        data:
          type: object
          nullable: true

    # Standard Error Response
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        status:
          type: integer
          example: 400
        message:
          type: string
          example: "Error message"
        error:
          type: object
          nullable: true

    # Pagination Meta
    PaginationMeta:
      type: object
      properties:
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 10
        total:
          type: integer
          example: 100

    # Company Schema
    Company:
      type: object
      properties:
        company_id:
          type: integer
          example: 1
        company_name:
          type: string
          example: "FPT Software"
        website:
          type: string
          format: uri
          example: "https://fpt-software.com"
        address:
          type: string
          example: "FPT Building, Cau Giay, Ha Noi"
        logo_url:
          type: string
          format: uri
          example: "https://example.com/logo.png"

    # Employer Schema
    Employer:
      type: object
      properties:
        employer_id:
          type: integer
          example: 1
        full_name:
          type: string
          example: "Nguyen Van A"
        email:
          type: string
          format: email
          example: "hr@fpt.com"
        role:
          type: string
          example: "HR Manager"
        company_id:
          type: integer
          example: 1
        company:
          $ref: "#/components/schemas/Company"

    # Job Schema (List)
    JobListItem:
      type: object
      properties:
        job_id:
          type: integer
          example: 1
        employer_id:
          type: integer
          example: 1
        job_title:
          type: string
          example: "Senior Backend Developer"
        description:
          type: string
          example: "We are looking for an experienced backend developer..."
        requirements:
          type: string
          example: "5+ years experience, Node.js, PostgreSQL"
        salary_min:
          type: number
          example: 20000000
        salary_max:
          type: number
          example: 40000000
        job_type:
          type: string
          enum: [Full-time, Part-time, Contract, Internship, Freelance]
          example: "Full-time"
        experience_level:
          type: string
          example: "Senior"
        posted_at:
          type: string
          format: date-time
          example: "2024-12-28T10:00:00.000Z"
        deadline:
          type: string
          format: date-time
          example: "2025-01-28T23:59:59.000Z"
        status:
          type: string
          enum: [active, closed, draft]
          example: "active"

    # Job Schema (Detail with Employer)
    JobDetail:
      allOf:
        - $ref: "#/components/schemas/JobListItem"
        - type: object
          properties:
            employer:
              $ref: "#/components/schemas/Employer"

    # Jobs List Response
    JobsListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: "#/components/schemas/JobListItem"
        total:
          type: integer
          example: 50
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 10

  # ---------------------
  # Parameters
  # ---------------------
  parameters:
    PathJobId:
      name: jobId
      in: path
      required: true
      description: Job ID
      schema:
        type: integer
        example: 1

    QueryPage:
      name: page
      in: query
      description: Page number (1-indexed)
      schema:
        type: integer
        minimum: 1
        default: 1
        example: 1

    QueryLimit:
      name: limit
      in: query
      description: Items per page
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 10
        example: 10

    QueryJobType:
      name: job_type
      in: query
      description: Filter by job type
      schema:
        type: string
        enum: [Full-time, Part-time, Contract, Internship, Freelance]
        example: "Full-time"

    QueryEmployerId:
      name: employer_id
      in: query
      description: Filter by employer ID
      schema:
        type: integer
        example: 1

  # ---------------------
  # Responses
  # ---------------------
  responses:
    BadRequest:
      description: Bad request - Invalid input
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            success: false
            status: 400
            message: "Invalid page (must be a positive integer)"
            error: null

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            success: false
            status: 404
            message: "Job with ID 99999 not found"
            error: null

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            success: false
            status: 500
            message: "Internal server error"
            error: null

# ===========================================
# API PATHS
# ===========================================

paths:
  # ---------------------
  # SERVER ENDPOINTS
  # ---------------------
  /:
    get:
      tags:
        - Server
      summary: Get server info
      description: Returns server information and available endpoints
      security: []
      responses:
        "200":
          description: Server info retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Job Search API Server"
                  version:
                    type: string
                    example: "1.0.0"
                  environment:
                    type: string
                    example: "development"
                  endpoints:
                    type: object
                    properties:
                      jobs:
                        type: string
                        example: "/api/jobs"
                      jobDetail:
                        type: string
                        example: "/api/jobs/:jobId"

  # ---------------------
  # JOBS ENDPOINTS
  # ---------------------
  /api/jobs:
    get:
      tags:
        - Jobs
      summary: Get all jobs
      description: |
        Get paginated list of jobs with optional filters.
        
        **Filters:**
        - `job_type`: Filter by job type (Full-time, Part-time, Contract, Internship, Freelance)
        - `employer_id`: Filter by employer ID
        
        **Pagination:**
        - `page`: Page number (default: 1)
        - `limit`: Items per page (default: 10, max: 100)
      security: []
      parameters:
        - $ref: "#/components/parameters/QueryPage"
        - $ref: "#/components/parameters/QueryLimit"
        - $ref: "#/components/parameters/QueryJobType"
        - $ref: "#/components/parameters/QueryEmployerId"
      responses:
        "200":
          description: Jobs retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/JobsListResponse"
              example:
                success: true
                status: 200
                message: "Jobs retrieved successfully"
                data:
                  data:
                    - job_id: 1
                      employer_id: 1
                      job_title: "Senior Backend Developer"
                      description: "We are looking for an experienced backend developer..."
                      requirements: "5+ years experience, Node.js, PostgreSQL"
                      salary_min: 20000000
                      salary_max: 40000000
                      job_type: "Full-time"
                      experience_level: "Senior"
                      posted_at: "2024-12-28T10:00:00.000Z"
                      deadline: "2025-01-28T23:59:59.000Z"
                      status: "active"
                    - job_id: 2
                      employer_id: 1
                      job_title: "Junior Frontend Developer"
                      description: "Looking for a motivated junior developer..."
                      requirements: "1+ years experience, React, TypeScript"
                      salary_min: 12000000
                      salary_max: 18000000
                      job_type: "Full-time"
                      experience_level: "Junior"
                      posted_at: "2024-12-27T08:00:00.000Z"
                      deadline: "2025-01-27T23:59:59.000Z"
                      status: "active"
                  total: 50
                  page: 1
                  limit: 10
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/jobs/{jobId}:
    get:
      tags:
        - Jobs
      summary: Get job by ID
      description: |
        Get detailed information about a specific job.
        
        **Response includes:**
        - Job details
        - Employer information
        - Company information
      security: []
      parameters:
        - $ref: "#/components/parameters/PathJobId"
      responses:
        "200":
          description: Job retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/JobDetail"
              example:
                success: true
                status: 200
                message: "Job retrieved successfully"
                data:
                  job_id: 1
                  employer_id: 1
                  job_title: "Senior Backend Developer"
                  description: "We are looking for an experienced backend developer..."
                  requirements: "5+ years experience, Node.js, PostgreSQL"
                  salary_min: 20000000
                  salary_max: 40000000
                  job_type: "Full-time"
                  experience_level: "Senior"
                  posted_at: "2024-12-28T10:00:00.000Z"
                  deadline: "2025-01-28T23:59:59.000Z"
                  status: "active"
                  employer:
                    employer_id: 1
                    full_name: "Nguyen Van A"
                    email: "hr@fpt.com"
                    role: "HR Manager"
                    company_id: 1
                    company:
                      company_id: 1
                      company_name: "FPT Software"
                      website: "https://fpt-software.com"
                      address: "FPT Building, Cau Giay, Ha Noi"
                      logo_url: "https://example.com/fpt-logo.png"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"
